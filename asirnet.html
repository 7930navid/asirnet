<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, user-scalable=yes">
    <title>AsirNet</title>
    <style>
        
  .loading-template {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 15px;
    border-radius: 10px;
    background: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
  }

 
  .loading-template .loading-image {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f0f4f8;
    border: 2px solid #3498db;
  }

  .loading-template .loading-image img {
    width: 80%;
    height: 80%;
    object-fit: cover;
  }

  .loading-template .loading-text {
    font-size: 0.9em;
    font-weight: 500;
    color: #555;
  }

  .loading-template .loader {
    display: flex;
    gap: 6px;
    justify-content: center;
  }

  .loading-template .dot {
    width: 6px;
    height: 6px;
    background-color: #3498db;
    border-radius: 50%;
    animation: wave 0.8s infinite;
  }

  .loading-template .dot:nth-child(1) { animation-delay: 0s; }
  .loading-template .dot:nth-child(2) { animation-delay: 0.1s; }
  .loading-template .dot:nth-child(3) { animation-delay: 0.2s; }
  .loading-template .dot:nth-child(4) { animation-delay: 0.3s; }
  .loading-template .dot:nth-child(5) { animation-delay: 0.4s; }
  .loading-template .dot:nth-child(6) { animation-delay: 0.5s; }

  @keyframes wave {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-6px); }
  }

  @media (max-width: 400px) {
    .loading-template .loading-image { width: 40px; height: 40px; }
    .loading-template .dot { width: 5px; height: 5px; }
    .loading-template .loading-text { font-size: 0.8em; }
  }
  
  
  
  .retryBtn {
    border: 2px solid #e67e22;
    border-radius: 10px;
    background: none;
    color: #e67e22;
    font-weight: bold;
    padding: 8px 18px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.3s ease;
}

.retryBtn:hover {
    background: #e67e22;
    color: white;
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
}
</style>



    <style>
body {
    background: white;
    }
#content {
    margin-bottom: 500px;
    min-height: 3000px;

}
#header { 
       display:flex; 
       align-items:center; 
       justify-content:space-between; 
       padding:20px; 
       background: white; 
       border-bottom:5px solid green; 
       position: fixed;
       z-index: 1000;
       top: 0;
       left: 0;
       right: 0;
       }

#header h1 { 
       margin:0; 
       color:green; 
       text-shadow:0 0 20px lightgreen; 
       }
#profPicture {
       background: none;
       height: 45px;
       width: 45px;
       border: none;
       border-radius: 90px;
       padding: 0;
       }

#bio {
    padding-top: 100px;
}
#post {
    width: 550px;
    padding: 10px;
    font-size: 20px;
    border-radius: 90px;
    border: 1px solid black;
    background: white;
}
#searchpad { 
       position:fixed; 
       top:0; 
       left:0; 
       width: 100%; 
       height:100%; 
       background:rgba(0,0,0,0.5); 
       display: none; 
       z-index:10000;
       padding: 30px; 
       } 
#search {
    height: 60px;
    width: 77%;
    border-radius: 90px;
    border-top-right-radius: 0px;
    border-bottom-right-radius: 0px;
    border: none;
    border-right: 1px solid black;
    background: white;
    padding: 10px;
    padding-left: 30px;
    font-size: 25px;
    color: red;
}
#btnsearch {
    height: 80px;
    border-radius: 90px;
    border-top-left-radius: 0px;
    border-bottom-left-radius: 0px;
    border: none;
    background: white;
    padding: 10px;
    padding-left: 30px;
    font-size: 25px;
    
}
#show {
    display: none;
    background: white;
    border-radius: 20px;
    width: 93%;
    height: 70%;
    margin-top: 40px;
}
#showheader h2 {
    color: green;
}
#showheader {
    width: 700px;
    height: 80px;
    border: none;
    border-bottom: 2px solid green;
    padding-left: 20px;
}
#searchresult {
    padding: 20px;
}
#close {
    background: red;
    padding: 10px;
    font-size: 20px;
    border-radius: 90px;
    color: white;
    border: none;
    height: 50px;
    width: 50px;
    margin-bottom: 15px;
    
}
#postpage { 
       position:fixed; 
       top:0; 
       left:0; 
       width: 100%; 
       height:100%; 
       background:rgba(0,0,0,0.5); 
       display: none; 
       z-index:10000;
       justify-content:center; 
       padding: 10px; 
       } 
#postpad {
    height: 80%;
    width: 650px;
    background: white;
    border-radius: 20px;
    padding: 20px;
}
#nameplate {
    width: 100%;
    border-bottom: 2px solid green;
}
#nameplate button {
    background: none;
    border: none;
    font-size: 30px;
    color: red;
}
#postsubmit {
    background: lightyellow;
    padding: 15px;
    font-size: 16px;
    border-radius: 10px;
    border: 2px solid green;
    color: green;
    margin-top: 20px;
}
#clear {
    width: 20%;
    background: lightpink;
    padding: 15px;
    font-size: 16px;
    border-radius: 20px;
    border: 2px solid red;
    color: red;
    margin-top: 20px;
    margin-right: 20px;
}
#postword {
    width: 600px;
    margin-top: 20px;
    border: 1px solid green;
    border-radius: 20px;
    height: 500px;
    padding: 20px;
    font-size: 30px;
    color: blue;
    font-family: 'SolaimanLipi', 'Noto Sans Bengali', Arial, sans-serif;
}
.postshow {
    padding: 20px;
    text-align: justify;
    margin: 25px;
    border-radius: 20px;
    background: white;
    min-height: 100px;
    width: 90%;
    box-shadow: 0 0 5px gray;
}
.postshow h2{
    color: green;
}
.postshow hr{
    background: green;
}
.postshow p{
    font-size: 25px;
}


#footer {
    background: white;
    border: none;
    border-top: 3px solid green;
    position: fixed;
    z-index: 100;
    width: 100%;
    min-height: 70px;
    bottom: 0;
    left: 0;
    padding: 20px;
}
#footerBtn {
    width: 90%;
}
#footerBtn td{
    text-align: center;
}
#footerBtn button {
    width: 110px;
    height: 80px;
    border: none;
    background: none;
    border-radius: 20px;
    font-size: 25px;

}
#footerBtn button:hover {
    background: rgba(0,100,255,0.1);

}
#specialBtn {
    width: 110px;
    height: 110px;
    border: 2px solid black;
    background: none;
    border-radius: 90px;
    font-size: 35px;
    padding: 5px;
}
#profdiv {
    background: white;
    padding: 20px;
    margin: 20px;
    border: none;
    border-radius: 20px;
}
#profdiv p{
    font-size: 50px;
    font-weight: bold;
    color: green;
}
#profdiv h5{
    color: red;
}
#profdiv hr{
    height: 15px;
    background: rgba(150,150,150,0.3);
}
#editbtn {
    position: absolute;
    z-index: 100;
    top: 330px;
    left: 260px;
}
#editbtn button{
    border: none;
    height: 60px;
    width: 60px;
    border-radius: 90px;
    box-shadow: 0 0 3px gray;
    font-size: 20px;
}
#profPic {
    background: rgba(255,255,0,0.1);
    height: 230px;    
    width: 230px;
    border: 10px solid rgba(0,0,0,0.2);
    border-radius: 360px;
    font-size: 150px;
    padding-top: 20px;
    padding-left: 20px;
}
#reactPanal {
    display: flex;
    padding: 10px;
    border: 1px solid green;
    border-radius: 20px;
    text-align: center;
    width: 70%;
    margin-left: 15%;
}
#reactPanal button {
    border: none;
    width: 33%;
    font-size: 20px;
    border-left: 1px solid green;
    background: none;
    cursor: pointer;
}

.appearFlex {
    position: fixed;
    z-index: 1000;
    bottom: 140px;
    left: 0;
    margin-bottom: 10px;
    display: none;
    overflow: auto;
    padding-left: 20px;
}
.appearFlex button {
    padding: 10px;
    font-size: 25px;
    border: none;
    border-radius: 20px;
    min-width: 70px;
    margin: 10px;
    background: none;
    box-shadow: 0 0 3px gray;
}
.appearFlex button:hover {
    transform: scale(1.25);
    transition: all 0.3s ease;
}
#modal {
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
}
#modal div {
    padding: 20px;
    padding-top: 10px;
    width: 50%;
    background: white;
    border-radius: 20px;
    border: 3px solid red;
    box-shadow: 0 0 5px white;
}
#modal p {
    color: red;
    font-size: 15px;
}
#modal input {
    width: 90%;
    margin-top: 15px;
    border: none;
    border-bottom: 3px solid rgba(0,0,0,0.2);
    padding: 10px;
    text-align: center;
    font-size: 20px;
    color: red;
}
#modal button {
    margin: 15px;
    padding: 10px;
    width: 20%;
    border: 2px solid red;
    border-radius: 10px;
    background: lightyellow;
    color: red;
    font-size: 14px;
}
.crossBtn {
    background: none;
    border: none;
}
#alert {
    color: red;
    font-size: 15px;
    margin: 10px;
}

.Display {
    height: 70%;
    width: 90%;
    box-shadow: 0 0 10px gray;
    border-radius: 20px;
    background: white;
    padding: 20px;
    overflow: auto;
}
.Display hr {
    background: green;
}
.Display h1 {
    color: green;
}
.Display div p{
    background: rgba(240,240,240);
    border-radius: 10px;
    box-shadow: 0 0 5px gray;
    margin: 20px;
    padding: 20px;
    width: 50%;
    text-align: justify;
    font-size: 20px;
}

.Display section {
    background: rgba(0,0,0,0.1);
    padding: 2px;
    border: 5px solid rgba(0,0,0,0.2);
    border-radius: 90px;
    font-size: 20px;
    margin-top: 20px;
}

.comSecDiv {
    height: 70%;
    width: 90%;
    background: white;
    border: none;
    border-radius: 15px;
}
.comWord {
    height: 200px;          
    width: 80%;                 
    padding: 20px;             
    margin: 40px ;  
    text-align: justify;      
    border: 2px solid green;     
    border-radius: 20px;         
    color: green;             
    font-size: 18px;          
    resize: vertical;      
    outline: none;            
    box-shadow: 0 0 5px rgba(0,128,0,0.3);
    font-family: Arial, sans-serif;
    transition: all 0.3s ease;  
}

.comWord:focus {
    border-color: darkgreen;    
    box-shadow: 0 0 10px rgba(0,128,0,0.5);
}

.combutton {
    border: 2px solid black;
    border-radius: 10px;
    padding: 10px;    
    font-size: 20px;
    background: rgba(0,0,0,0.1);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px); 
    color: black;
    position: fixed;
    z-index: 1000;
    bottom: 880px;    
    right: 110px;     
    cursor: pointer;
    transition: all 0.3s ease;
}


.combutton:hover {
    background: green;
    color: white;
    transform: scale(1.15);
    box-shadow: 0 0 15px rgba(0,255,0,0.6);
}
.combutton:active {
    transform: scale(0.95);
}
.crossBtn {
    width: 30px;
    height: 30px;
    border: none;
    background: none;
    color: red;
    font-size: 30px;
    font-weight: bold;
    margin-left: 150px;
}

#countReactions button{
    font-size: 15px;
    background: none;
    border: none;
}
       .likeAppear {
           width: 100%;
           border: none;
           border-bottom: 1px solid black;
           border-top: 1px solid black;
       }
       .likeAppear div {
           font-size: 40px;
           border-right: 1px solid black;
           margin: 5px;
           width: 70px;
       }
       .likeAppear h1 {
           color: green;
       }
       .likeAppear p {
           color: blue;
           font-size: 20px;
           box-shadow: 0;
       }
       .likeAppear section {
           font-size: 40px;
           padding: 5px;
           border: 1px solid green;
           border-radius: 5px;
           box-shadow: 0 0 4px lightgreen;
           width: 60px;
           margin: 5px;
           background: none;
       }


    </style>
</head>
<body id="body">
<div id="header">
<img src="https://i.ibb.co.com/wNpFN8qH/IMG-20251103-150220.jpg"  width="200px">
  <h1 id="profPicture"></h1>
</div>
      

<div id="bio"></div>

<div id="searchpad">
<div style="background: none; width: 100%;">
    <div style="text-align: right; padding-right: 70px;">
        <button onclick="closealert('show');closealert('searchpad');" id="close">√ó</button>
    </div>
    <input type="text" id="search" placeholder="Search here.."/>
    <button onclick="pad();" id="btnsearch"><img src="https://i.ibb.co.com/hxhm3n7y/search-interface-symbol.png" alt="search interface symbol" border="0" width="25"></button>  
   
          <div id="show">
              <div>
              <div id="showheader">
              <h2>
                 Search Result
              </h2>
              </div>
              <div id="searchresult"></div>
          </div>
          </div>

 </div>
    </div>
 
 <div id="postpage">
 <div id="postpad">
      <table border="0" id="nameplate"><tr><td><h2 style="text-align: left; color: green;">Create your mind here..</h2>
 </td><td>
      <div style="text-align: right">
          <button onclick="closealert('postpage')">√ó</button>
      </div> 
      </td> 
      </tr>
      </table>
                <div style="text-align: right;">
               <button onclick="postsubmit()" id="postsubmit">Post </button>
         </div>

      <div>         
      <textarea id="postword" placeholder="What's on your mind?"></textarea>

      </div>
 </div>
 </div> 
<div id="content">
    <br><br>
</div>
<div id="appearFlex">
</div>
<footer id="footer">
    <div>
        <table id="footerBtn">
            <tr>
<td><button onclick="location.reload()"><img src="https://i.ibb.co.com/wZFh56jy/home.png" alt="home" border="0" width="40"></button></td>
<td><button onclick="profile();loadProfile();"><img src="https://i.ibb.co.com/YgKxNZB/user.png" alt="user" border="0" width="40"></button></td>
<td><button onclick="createpost()" style="    
    width: 90px;
    height: 90px;
    border: 2px solid black;
    background: none;
    border-radius: 90px;
    font-size: 40px;
    padding: 5px;
    color: black;
">+</button></td>
<td><button onclick="setting();"><img src="https://i.ibb.co.com/F4RcTPbR/setting.png" alt="setting" border="0" width="40"></button></td>
<td><button onclick="searchpad();"><img src="https://i.ibb.co.com/hxhm3n7y/search-interface-symbol.png" alt="search interface symbol" border="0" width="40"></button></td>
            </tr>
        </table>
    </div>
</footer>



    


<script>
    
    
    

function closealert(id) {
    document.getElementById(id).style.display = 'none';
}

function profile() {
const u = JSON.parse(localStorage.getItem("user"));
const s = JSON.parse(styleString);

    document.getElementById('content').innerHTML =`
 <div id="profdiv">
     <table align="center"><tr><td width="270">
     <div id="profPic"></div></td><td width="400">
     <p id="userName"></p>
     <h5><i id="profileBio"></i></h5>
  </td></tr></table>
  <div id="editbtn"><a href="profileEdit.html">
  <button>‚úèÔ∏è</button>
  </a></div> <br><br><br><hr></div>
 
 <div id="ownerPosts"></div>   
    
    `;

document.getElementById('profPic').innerHTML = `${u.avatar}`;       
document.getElementById('userName').innerHTML = `${u.username}`;       
document.getElementById('profileBio').innerHTML = `${u.bio}`;       

showLoader("ownerPosts", "Loading Owner's posts...");

warning(
    () => showWarning(".warn", "‚ö† Network seems slow!", () => {
        profile();
    }),
    5000,
    0,
    3000
);


loadProfilePosts();


}


function setting() {
location.href = 'setting.html';
  }
  
  

function searchpad() {
    document.getElementById('searchpad').style.display = 'flex';  
}

async function pad() {
    let search = document.getElementById('search').value;
    if(!search) {
        document.getElementById("show").style.display = 'none';  
        alert('Please search anything before');
    } else {
        document.getElementById('show').style.display = 'flex'; 
        
    
    const search = document.getElementById('search').value.trim().toLowerCase();
    const showDiv = document.getElementById("searchresult");

    // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá
    try {
        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶®‡¶õ‡ßá
        const res = await fetch("https://users-server-xyvg.onrender.com/users");
        const users = await res.json();

        // ‡¶∂‡ßÅ‡¶ß‡ßÅ ID ‡¶¨‡¶æ email ‡¶¶‡¶ø‡ßü‡ßá filter
        const results = users.filter(u => u.username.toLowerCase().includes(search));

        if (results.length === 0) {
            showDiv.style.display = 'flex';
            showDiv.innerHTML = `<p style=" color:red">No user found for "<b>${search}</b>"</p>`;
        } else {
            showDiv.style.display = 'flex';
            showDiv.innerHTML = results.map(u => `
                <div style="border:none; margin:5px; padding:10px; color: green; width: 700px;">
                    ${u.username} <br><hr>
                </div>
            `).join("");
      }  
    } catch (err) {
        alert("Check your network connection please!!");
    }
}
          
    }


function createpost() {
    document.getElementById('postpage').style.display = 'flex';   
} 

function clearpost() {
    document.getElementById('postword').value = "";    
} 

async function postsubmit() {
  const input = document.getElementById('postword');
  const text = input.value.trim();

  if (!text) {
    alert("Please write something!");
    return;
  }

  const user = JSON.parse(localStorage.getItem("user"));
  if (!user || !user.username) {
    alert("User not found!");
    return;
  }

  const btn = document.getElementById("postbtn");
  if (btn) btn.disabled = true;

  try {
    const res = await fetch("https://posts-server-plog.onrender.com/post", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
body: JSON.stringify({
  user: {
    username: user.username,
    email: user.email
  },
  text: text,
  avatar: user.avatar 
})    

});

    // ‚ùå Server responded with error (4xx or 5xx)
    if (!res.ok) {
      let serverData = {};
      try {
        serverData = await res.json();
      } catch (e) {
        console.error("Error parsing server response:", e);
      }

      // Pretty print server error
      console.error(
        `Server Error Response (status: ${res.status} ${res.statusText}):\n`,
        JSON.stringify(serverData, null, 2)
      );

      alert("Server error. Please try again.");
      return;
    }

    // ‚úÖ Success
    const data = await res.json();

    const div = document.createElement('div');
    div.className = "postshow";

    const h2 = document.createElement("h2");
    h2.textContent = `${user.avatar || "üôÇ"} ${user.username}`;

    const p = document.createElement("p");
    p.textContent = text; // safe from XSS

    div.appendChild(h2);
    div.appendChild(document.createElement("hr"));
    div.appendChild(p);

    document.getElementById('content').appendChild(div);
    input.value = "";
    closealert('postpage');

    alert("Posted successfully!");

  } catch (err) {
    // ‚ùå Network / JS error
    console.error("Network / JS Error:", err);
    alert("Something went wrong. Please try again.");
  } finally {
    if (btn) btn.disabled = false;
  }
}

async function loadPosts() {

    try {
        const res = await fetch("https://posts-server-plog.onrender.com/post");
        const data = await res.json();

        if (res.ok) {
            const contentDiv = document.getElementById("content");
            contentDiv.innerHTML = "";

            data.forEach(post => {
                const div = document.createElement("div");
                div.className = "postshow";
                div.innerHTML = `<h2><span style="padding: 5px; border-right: 2px solid rgba(0,0,0,0.2); margin-right: 10px;">${post.avatar} </span>${post.username}</h2><hr>
    
    <p>${post.text.replace(/\n/g, "<br>")}</p>
    
    <div id="countReactions">
   <div id="countByOrder${post.id}" style="text-align: right">
 <button id="likeCount${post.id}" onclick="likeContainer(${post.id}); reactors(${post.id})"></button> <br>     
 <button id="commentCount${post.id}" onclick="appContainer(${post.id}); comText(${post.id})"></button>      
   </div>
     </div>
    
    <div id="reactPanal">
<button onclick="appImoji(${post.id})" style="border-left: none;"
 id="react${post.id}">
 <img src="https://i.ibb.co.com/NgV9p5jg/like.png" alt="like" border="0" width="40"></button>
<button onclick="comSec(${post.id})" id="comSec${post.id}"><img src="https://i.ibb.co.com/hRNSdTgD/comment.png" alt="comment" border="0" width="40"></button>
<button onclick="appLink(${post.id})"><img src="https://i.ibb.co.com/dsY2VXG0/share.png" alt="share" border="0" width="40"></button>
    </div>
    
    <div id="appearFlex${post.id}" class='appearFlex'>
<button onclick="reactAppear(${post.id},'üëç')">üëç</button>
<button onclick="reactAppear(${post.id},'‚ô•Ô∏è')">‚ô•Ô∏è</button>
<button onclick="reactAppear(${post.id},'ü§£')">ü§£</button>
<button onclick="reactAppear(${post.id},'üòÅ')">üòÅ</button>
<button onclick="reactAppear(${post.id},'ü§î')">ü§î</button>
<button onclick="reactAppear(${post.id},'ü•∞')">ü•∞</button>
<button onclick="reactAppear(${post.id},'üò•')">üò•</button>
<button onclick="reactAppear(${post.id},'üò°')">üò°</button>
</div>

<div id="comPen${post.id}" style="display:none; position: fixed; z-index: 100; height: 100%; width: 100%; background: rgba(0,0,0,0.3); top:0; left: 0; justify-content: center;align-items: center;">
    
    <div class="comSecDiv">
  <table>
      <tr>
          <td>
              <h2 style="margin-left: 20px;">
Write a comment here about this post..                 
              </h2>
          </td>
          <td>
<button onclick="closealert('comPen${post.id}')" class="crossBtn">
    √ó
</button>             
          </td>
      </tr>
  </table> 
  <hr> 
     <textarea class="comWord" placeholder="Enter here your comment..."></textarea>   
     <button onclick="sendCom(${post.id})" class="combutton">
         Send 
     </button>      
   
    </div>
  
 </div>   


<div id="commentContainer${post.id}" style="   
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
">
    <div class="Display">
  <table style="width: 100%;"><tr><td>      
          <h1 id="reactName">Comments</h1></td><td>
    <div style="text-align: right;">
<button 
    style="
        color: red; 
        font-size: 30px; 
        border: none; 
        background: none; 
        cursor: pointer;" 
    onclick="closeContainer(${post.id})"
>
    √ó </button>  
     </div>
      </td></tr></table>
        <hr>
 <div id="comText${post.id}" style="position: relative"></div>       
    </div>
</div>


<div id="likeContainer${post.id}" style="   
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
">
    <div class="Display">
  <table style="width: 100%;"><tr><td>      
          <h1 id="reactName">Reactions</h1></td><td>
    <div style="text-align: right;">
<button 
    style="
        color: red; 
        font-size: 30px; 
        border: none; 
        background: none; 
        cursor: pointer;" 
    onclick="closeLikeContainer(${post.id})"
>
    √ó </button>  
     </div>
      </td></tr></table>
        <hr>
 <div id="reactors${post.id}" style="position: relative"></div>       
    </div>
</div>

    `;
    
       // let displayText = postText.length > 5 ? postText.slice(0, 5) + "..." : postText;


                contentDiv.appendChild(div);
                updateCounts(post.id);
            });
        } else {
            alert(data.message || "Error loading posts!");
        }
    } catch (err) {
 }
}


async function reactors(postId) {
  try {
    const res = await fetch(
      `https://interacts-server.onrender.com/likes/${postId}`
    );
    const data = await res.json();

    const container = document.getElementById(`reactors${postId}`);
    container.innerHTML = ""; // clear previous

    if (!data.likes || data.likes.length === 0) {
      container.innerHTML = "No likes yet üòê";
      return;
    }

    // üîπ Map likes to HTML
    const listHTML = data.likes
      .map(l => {
        return `
          <table class="likeAppear">
            <tr>
              <td>
                <div>${l.avatar || "üôÇ"}</div>
              </td>
              <td>
                <h1>${l.username}</h1>
              </td>
              <td><p style="box-shadow:0 0 0px white; padding: 0; margin:0; background: none; width: 150px;">
                reacted with
              </p></td>
              <td style="font-size:20px"><section>
                ${l.reaction}</section>
              </td>
            </tr>
          </table>
        `;
      })
      .join("");

    container.innerHTML = listHTML;

  } catch (err) {
    console.error("Reactors fetch error:", err);
  }
}

function comSec(appear) {
   document.getElementById(`comPen${appear}`).style.display  = 'flex';
}

async function comText(postId) {
    const box = document.getElementById(`comText${postId}`);
    box.innerHTML = "Loading comments...";

    try {
        const res = await fetch(`https://interacts-server.onrender.com/comments/${postId}`);
        const comments = await res.json();

        if (!comments || comments.length === 0) {
            box.innerHTML = "<p style='color: red;'>No comments yet</p>";
            return;
        }

        const currentUser = JSON.parse(localStorage.getItem("user")); // Logged in user
        const currentEmail = currentUser ? currentUser.email : null;

        box.innerHTML = "";

        comments.forEach(c => {
            const div = document.createElement("div");
    
    let comId = `${c.id}`;        
 
          
            const menuHTML = (currentEmail && currentEmail === c.email) ? `
                <div class="comMenu" style="display:none; position: absolute; right: 110px; top: 50px; border:1px solid gray; background:white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <button
 style="background: none; border: none; border-bottom: 1px solid gray; width: 100%;"           
             onclick="editCom(${comId}, '${postId}', '${c.comment.replace(/'/g, "\\'").replace(/\n/g, "\\n")}')">Edit</button>
            <br>
                  <button style="color: red; background: none; border: none; width: 100%; margin-top: 10px;" onclick="deleteCom(${c.id}, ${postId})">Delete</button>
                </div>
            ` : "";

            div.innerHTML = `
            <div style="position: relative; margin-bottom: 30px;">
              <table>
                <tr>
                  <td valign="top"><h2>${c.avatar}</h2></td>
                  <td>
                    <div style="
                        background: rgba(0,0,0,0.1);   
                        padding: 10px; 
                        border-radius: 10px;
                        width: 500px;
                        margin-left: 30px;
                        border-left: 5px solid gray;">
                      <table>
                        <tr>
                          <td><h3 style="color: green; margin: 0;">${c.username}</h3></td>
                          <td>
                            ${menuHTML ? `<button class="dropdownBtn" style="width: 20px; background: none; border: none; height: 40px; color: green; font-size: 20px; margin-left: 360px">‚ãÆ</button>` : ""}
                          </td>
                        </tr>
                      </table>
                      <hr style="background: green;">
                      
   <div id="commentText${c.id}">                   
                      <p style="text-align: justify; font-size: 18px; margin:0; box-shadow: none; background: 0; padding: 0; width: 100%;">${c.comment}</p>
                      ${menuHTML}
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            `;

            box.appendChild(div);

            // Dropdown toggle only if menu exists
            if (menuHTML) {
                const dropdownBtn = div.querySelector(".dropdownBtn");
                const menu = div.querySelector(".comMenu");

                dropdownBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const isOpen = menu.style.display === "block";
                    document.querySelectorAll(".comMenu").forEach(m => m.style.display = "none"); // close all
                    menu.style.display = isOpen ? "none" : "block";
                });
            }
        });

        // Close dropdown if click outside
        document.addEventListener("click", () => {
            document.querySelectorAll(".comMenu").forEach(menu => menu.style.display = "none");
        });

    } catch (err) {
        console.error(err);
        box.innerHTML = "<p style='color:red'>Failed to load comments</p>";
    }
}


async function updateCounts(postId) {
    const likeEl = document.getElementById(`likeCount${postId}`);
    const commentEl = document.getElementById(`commentCount${postId}`);

    try {
        const res = await fetch(`https://interacts-server.onrender.com/api/counts/${postId}`);
        if (!res.ok) throw new Error("Failed to fetch counts");

        const data = await res.json();
        if (likeEl) likeEl.textContent = `${data.likes} reactions`;
        if (commentEl) commentEl.textContent = `${data.comments} comments`;

    } catch (err) {
        console.error(`Error updating counts for post ${postId}:`, err);
        if (likeEl) likeEl.textContent = "‚Äì reactions";
        if (commentEl) commentEl.textContent = "‚Äì comments";
    }
}


async function sendCom(postId) {
    const overlay = document.getElementById(`comPen${postId}`);
    const textarea = overlay.querySelector(".comWord");
    const btn = overlay.querySelector(".combutton");
    const comment = textarea.value.trim();

    if (!comment) {
        alert("Please write a comment first!");
        return;
    }

    const user = JSON.parse(localStorage.getItem("user"));
    if (!user || !user.username || !user.email) {
        alert("User not found!");
        return;
    }

    btn.disabled = true;

    try {
        const res = await fetch("https://interacts-server.onrender.com/comment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                postId: Number(postId),
                email: user.email,
                username: user.username,
                avatar: user.avatar ,
                comment
            })
        });

        if (!res.ok) {
            const errData = await res.json().catch(() => ({}));
            console.error("Server Error:", res.status, errData);
            alert(errData.message || "Failed to send comment!");
            return;
        }

        const data = await res.json();
        console.log("Saved comment:", data.comment);

        textarea.value = "";
        overlay.style.display = "none";
        alert("Comment posted ‚úÖ");

    } catch (err) {
        console.error("Network / JS Error:", err);
        alert("Network error!");
    } finally {
        btn.disabled = false;
    }
}

async function reactAppear(postId, emoji) {
  document.getElementById(`appearFlex${postId}`).style.display = "none";

  try {
    const user = JSON.parse(localStorage.getItem("user"));

    if (!user || !user.email || !user.username) {
      alert("You must be logged in to react!");
      return;
    }

    const res = await fetch(
      "https://interacts-server.onrender.com/react",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          postId: postId,
          email: user.email,
          username: user.username,
          avatar: user.avatar,
          reaction: emoji
        })
      }
    );

    const data = await res.json();

    if (res.ok) {
      // UI update
      document.getElementById(`react${postId}`).innerHTML = emoji;
    } else {
      alert(data.message || "You have already reacted!");
    }

  } catch (err) {
    console.error("Error sending reaction:", err);
    alert("Something went wrong while sending your reaction.");
  }
}




function loadProfile() {
    const user = localStorage.getItem("user");
    if(user) {
        const u = JSON.parse(user);
document.getElementById("userName").innerHTML = u.username;
document.getElementById("profileBio").innerHTML = u.bio;

    }
    
}

function backtoprofile() {
    profile();
    document.querySelector('#backbtn').innerHTML = "";
}



// üîπ Load Current User Posts
async function loadProfilePosts() {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) return;

    const res = await fetch("https://posts-server-plog.onrender.com/post");
    const allPosts = await res.json();

    // ‡¶∂‡ßÅ‡¶ß‡ßÅ current user-‡¶è‡¶∞ post filter
    const userPosts = allPosts.filter(p => p.email === user.email);

    const profileDiv = document.getElementById("ownerPosts");
    profileDiv.innerHTML = `<div id="userposts"></div>`;
    const postsDiv = document.getElementById("userposts");

    userPosts.forEach((p, i) => {
        const div = document.createElement("div");
        div.className = "postshow";
        div.innerHTML = `
            <div style="position: relative;">
                <table border="0" style="width: 100%;">
                    <tr>
                        <td><h3 style="color: green"><span style="padding: 5px; border-right: 2px solid rgba(0,0,0,0.2); margin-right: 10px;">${user.avatar} </span>${user.username}</h3></td>
                        <td style="text-align: right;">
                            <button 
                                id="dropdownBtn${p.id}" 
                                style="width: 20px; background: none; border: none; height: 40px; color: green; font-size: 30px;"
                            >‚ãÆ</button>
                        </td>
                    </tr>
                </table>
                <hr>
                <p id="posttext${p.id}">${p.text.replace(/\n/g, "<br>")}</p>
                
                
                <div id="menu${p.id}" 
                    style="display:none; position: absolute; right: 0; top: 70px; border:1px solid gray; background:white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <button style="background: none; border: none; border-bottom: 1px solid gray; border-radius: 0; width: 100%;" onclick="editPost(${p.id}); closealert('menu${p.id}');">Edit</button><br>
                    <button style="color: red; background: none; border: none; border-radius: 0; margin-top: 10px; width: 100%;" onclick="deletePost(${p.id}); closealert('menu${p.id}');">Delete</button>
                </div>
            </div>
        `;
        postsDiv.appendChild(div);

        // üéØ Dropdown toggle system
        const dropdownBtn = div.querySelector(`#dropdownBtn${p.id}`);
        const menu = div.querySelector(`#menu${p.id}`);

        dropdownBtn.addEventListener("click", (e) => {
            e.stopPropagation(); // prevent document click from closing instantly
            const isOpen = menu.style.display === "block";
            document.querySelectorAll("[id^='menu']").forEach(m => m.style.display = "none"); // close all
            menu.style.display = isOpen ? "none" : "block"; // toggle current one
        });
    });

    // üß† Global click listener ‚Äî close dropdown if click outside
    document.addEventListener("click", (e) => {
        document.querySelectorAll("[id^='menu']").forEach(menu => {
            if (!menu.contains(e.target)) {
                menu.style.display = "none";
            }
        });
    });
}

// üîπ Edit Post
function editPost(id) {
    const el = document.getElementById(`posttext${id}`);
    if (!el) {
        console.error("Element not found for id:", id);
        return;
    }
    const textareaId = `editpost${id}`;
    const postText = el.innerText;

    el.outerHTML = `
        <table style="width: 100%;">
            <tr>
                <td>
                    <textarea id="${textareaId}" style="width: 80%; margin-top: 20px; border: 1px solid green; border-radius: 10px; height: 100px; padding: 20px; font-size: 16px; color: red;">${postText}</textarea>
                </td>
                <td>
                    <button onclick="savePost(${id})" style="background:white;width:100px;height:50px;border:1px solid green;border-radius:10px;color:green;margin-bottom:20px;">Save</button>
                    <br>
                    <button onclick="loadProfilePosts()" style="background:white;width:100px;height:50px;border:1px solid red;border-radius:10px;color:red;">Cancel</button>
                </td>
            </tr>
        </table>
    `;
}

// üîπ Save Post (PUT)
async function savePost(id) {
    const user = JSON.parse(localStorage.getItem("user"));
    const newText = document.getElementById(`editpost${id}`).value;

    try {
        const res = await fetch(`https://posts-server-plog.onrender.com/post/${user.email}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: newText })
        });
        const data = await res.json();
        alert(data.message);
        loadProfilePosts();
    } catch(err) {
        console.error("Error saving post:", err);
        alert("Failed to save post.");
    }
}

// üîπ Delete Post
async function deletePost(id) {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!confirm("Are you sure to delete this post?")) return;

    try {
        const res = await fetch(`https://posts-server-plog.onrender.com/post/${user.email}/${id}`, { method: "DELETE" });
        const data = await res.json();
        alert(data.message);
        loadProfilePosts();
    } catch(err) {
        console.error("Error deleting post:", err);
        alert("Failed to delete post.");
    }
}


// üîπ Edit comment
function editCom(comId, postId, encodedText) {
    let commentDiv = document.getElementById(`commentText${comId}`);

    if (!commentDiv) return;

    const currentText = decodeURIComponent(encodedText);

    commentDiv.innerHTML = `
        <textarea id="editArea${comId}" style="width:80%; height:80px; margin: 20px; border: 2px solid green; border-radius: 20px; box-shadow: 0 0 5px lightgreen; color: green; padding: 10px;">${currentText}</textarea>
        <br>
        <div style="text-align:right;">
        <button id="saveBtn${comId}" style="border: none; border-radius: 5px; background: rgb(0,200,0); color: rgb(255,255,255); padding: 4px;width: 100px;">Save</button>
        <button id="cancelBtn${comId}" style="border: none; border-radius: 5px; background: rgb(200,0,0); color: rgb(255,255,255); padding: 4px;width: 100px;">Cancel</button>
</div>
    `;

    document.getElementById(`saveBtn${comId}`).onclick = async () => {
    
    const user = JSON.parse(localStorage.getItem("user"));
        const newComment = document.getElementById(`editArea${comId}`).value.trim();
        if (!newComment) return alert("Comment cannot be empty!");

        try {
            const res = await fetch(`https://interacts-server.onrender.com/comment/${user.email}/${comId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ newComment })
            });
            const data = await res.json();
            if (!res.ok) return alert(data.message || "Failed to update comment");

            alert("Comment updated ‚úÖ");
            comText(postId); // Refresh comments
        } catch (err) {
            console.error(err);
            alert("Network error: could not update comment.");
        }
    };

    document.getElementById(`cancelBtn${comId}`).onclick = () => {
        commentDiv.innerHTML = currentText;
    };
}


// üîπ Delete comment
async function deleteCom(commentId, postId) {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user || !user.email) {
        alert("User not found!");
        return;
    }

    if (!confirm("Are you sure you want to delete this comment?")) return;

    try {
        const res = await fetch(
            `https://interacts-server.onrender.com/comment/${user.email}/${commentId}`,
            { method: "DELETE" }
        );

        const data = await res.json();

        if (!res.ok) {
            alert(data.message || "Failed to delete comment.");
            return;
        }

        alert("Comment deleted ‚úÖ");

        // Update the comments section for this post
        if (postId) {
            comText(postId); // reload comments for the post
        }
    } catch (err) {
        console.error("Error deleting comment:", err);
        alert("Network error: could not delete comment.");
    }
}






// üîπ Close dropdown
function closealert(menuId) {
    const el = document.getElementById(menuId);
    if(el) el.style.display = "none";
}


let closePlace = document.querySelector('#body');


function appImoji(id) {
document.getElementById(`appearFlex${id}`).style.display ='flex';
}



function closeImoji(id) {
    document.getElementById(`appearFlex${id}`).style.display ='none';
}

function closeContainer(container){
    document.getElementById(`commentContainer${container}`).style.display = 'none';
}

function appContainer(container) {
document.getElementById(`commentContainer${container}`).style.display ='flex';
}

function likeContainer(container) {
document.getElementById(`likeContainer${container}`).style.display ='flex';
}

function closeLikeContainer(container){
    document.getElementById(`likeContainer${container}`).style.display = 'none';
}



function appLink(postId) {
alert('üò• under contraction!');
//  const postUrl = `${window.location.origin}/post/${postId}`;
//  navigator.clipboard.writeText(postUrl);
}
</script>


<script>
window.onload = function() {
    const user = localStorage.getItem("user");
    if(!user) {
        alert("Please login first!");
        location.href = "register.html";
    } else {
        const u = JSON.parse(user);
        document.getElementById('profPicture').innerHTML = `${u.avatar}`; 
        loadPosts();
    }
}

// localStorage ‡¶•‡ßá‡¶ï‡ßá style ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶∏‡¶æ
const styleString = localStorage.getItem('style');
if (styleString) {
    const s = JSON.parse(styleString);
    document.getElementById('body').style.backgroundColor = s.background;
}

// ---------------------
// Loader Template Function
// ---------------------
function showLoader(targetId = "content", message = "Please wait...") {
    const loading = `
    <div style="width: 100%; text-align: center; margin-top: 20px;">
      <div class="loading-template">
        <div class="loading-image">
          <img src="https://i.ibb.co/67Tcn3S8/IMG-20251216-151652.png" >
        </div>
        <div class="warn">
          <div class="loading-text">${message}</div>
          <div class="loader">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>
      </div>
    </div>
    `;

    const target = document.getElementById(targetId);
    if (target) target.innerHTML = loading;
}

// ---------------------
// Warning Function
// ---------------------
function showWarning(targetSelector = ".warn", message = "‚ö† Check Your Network please!", retryFunc = null) {
    const warnEl = document.querySelector(targetSelector);
    if (!warnEl) return;

    warnEl.innerHTML = `
        <p style="color: red">${message}</p>
        <button class="retryBtn">‚ö° Retry</button>
    `;

    const btn = warnEl.querySelector(".retryBtn");
    if (btn) {
        btn.addEventListener("click", () => {
            if (typeof retryFunc === "function") {
                retryFunc(); // user-defined function call
            } else {
                console.log("No retry function provided, default reload");
                location.reload(); // fallback
            }
        });
    }
}


function warning(func, interval = 3000, duration = 0, delay = 3000) {
    if (typeof func !== "function") {
        console.error("‚ö† You must provide a function to run!");
        return;
    }

    const timeoutId = setTimeout(() => {
        const intervalId = setInterval(() => {
            func();
        }, interval);

        if (duration > 0) {
            setTimeout(() => {
                clearInterval(intervalId);
                console.log("‚èπ Warning stopped");
            }, duration);
        }
    }, delay);

    return timeoutId;
}


showLoader("content", "Loading posts...");

warning(
    () => showWarning(".warn", "‚ö† Network seems slow!", () => {
        location.reload();
    }),
    5000,
    0,
    3000
);


</script></body>
</html>
