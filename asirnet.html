<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, user-scalable=yes">
    <title>AsirNet</title>
    <style>
        
  .loading-template {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 15px;
    border-radius: 10px;
    background: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
  }

 
  .loading-template .loading-image {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f0f4f8;
    border: 2px solid #3498db;
  }

  .loading-template .loading-image img {
    width: 80%;
    height: 80%;
    object-fit: cover;
  }

  .loading-template .loading-text {
    font-size: 0.9em;
    font-weight: 500;
    color: #555;
  }

  .loading-template .loader {
    display: flex;
    gap: 6px;
    justify-content: center;
  }

  .loading-template .dot {
    width: 6px;
    height: 6px;
    background-color: #3498db;
    border-radius: 50%;
    animation: wave 0.8s infinite;
  }

  .loading-template .dot:nth-child(1) { animation-delay: 0s; }
  .loading-template .dot:nth-child(2) { animation-delay: 0.1s; }
  .loading-template .dot:nth-child(3) { animation-delay: 0.2s; }
  .loading-template .dot:nth-child(4) { animation-delay: 0.3s; }
  .loading-template .dot:nth-child(5) { animation-delay: 0.4s; }
  .loading-template .dot:nth-child(6) { animation-delay: 0.5s; }

  @keyframes wave {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-6px); }
  }

  @media (max-width: 400px) {
    .loading-template .loading-image { width: 40px; height: 40px; }
    .loading-template .dot { width: 5px; height: 5px; }
    .loading-template .loading-text { font-size: 0.8em; }
  }
  
  
  
  .retryBtn {
    border: 2px solid #e67e22;
    border-radius: 10px;
    background: none;
    color: #e67e22;
    font-weight: bold;
    padding: 8px 18px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.3s ease;
}

.retryBtn:hover {
    background: #e67e22;
    color: white;
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
}
</style>



    <style>
body {
    background: white;
    }
#content {
    margin-bottom: 500px;
    min-height: 3000px;

}
#header { 
       display:flex; 
       align-items:center; 
       justify-content:space-between; 
       padding:20px; 
       background: white; 
       border-bottom:5px solid green; 
       position: fixed;
       z-index: 1000;
       top: 0;
       left: 0;
       right: 0;
       }

#header h1 { 
       margin:0; 
       color:green; 
       text-shadow:0 0 20px lightgreen; 
       }
#profPicture {
       background: none;
       height: 45px;
       width: 45px;
       border: none;
       border-radius: 90px;
       padding: 0;
       }

#bio {
    padding-top: 100px;
}
#post {
    width: 550px;
    padding: 10px;
    font-size: 20px;
    border-radius: 90px;
    border: 1px solid black;
    background: white;
}
#searchpad { 
       position:fixed; 
       top:0; 
       left:0; 
       width: 100%; 
       height:100%; 
       background:rgba(0,0,0,0.5); 
       display: none; 
       z-index:10000;
       padding: 30px; 
       } 
#search {
    height: 60px;
    width: 77%;
    border-radius: 90px;
    border-top-right-radius: 0px;
    border-bottom-right-radius: 0px;
    border: none;
    border-right: 1px solid black;
    background: white;
    padding: 10px;
    padding-left: 30px;
    font-size: 25px;
    color: red;
}
#btnsearch {
    height: 80px;
    border-radius: 90px;
    border-top-left-radius: 0px;
    border-bottom-left-radius: 0px;
    border: none;
    background: white;
    padding: 10px;
    padding-left: 30px;
    font-size: 25px;
    
}
#show {
    display: none;
    background: white;
    border-radius: 20px;
    width: 93%;
    height: 70%;
    margin-top: 40px;
}
#showheader h2 {
    color: green;
}
#showheader {
    width: 700px;
    height: 80px;
    border: none;
    border-bottom: 2px solid green;
    padding-left: 20px;
}
#searchresult {
    padding: 20px;
}
#close {
    background: red;
    padding: 10px;
    font-size: 20px;
    border-radius: 90px;
    color: white;
    border: none;
    height: 50px;
    width: 50px;
    margin-bottom: 15px;
    
}
#postpage { 
       position:fixed; 
       top:0; 
       left:0; 
       width: 100%; 
       height:100%; 
       background:rgba(0,0,0,0.5); 
       display: none; 
       z-index:10000;
       justify-content:center; 
       padding: 10px; 
       } 
#postpad {
    height: 80%;
    width: 650px;
    background: white;
    border-radius: 20px;
    padding: 20px;
}
#nameplate {
    width: 100%;
    border-bottom: 2px solid green;
}
#nameplate button {
    background: none;
    border: none;
    font-size: 30px;
    color: red;
}
#postsubmit {
    background: lightyellow;
    padding: 15px;
    font-size: 16px;
    border-radius: 10px;
    border: 2px solid green;
    color: green;
    margin-top: 20px;
}
#clear {
    width: 20%;
    background: lightpink;
    padding: 15px;
    font-size: 16px;
    border-radius: 20px;
    border: 2px solid red;
    color: red;
    margin-top: 20px;
    margin-right: 20px;
}
#postword {
    width: 600px;
    margin-top: 20px;
    border: 1px solid green;
    border-radius: 20px;
    height: 500px;
    padding: 20px;
    font-size: 30px;
    color: blue;
    font-family: 'SolaimanLipi', 'Noto Sans Bengali', Arial, sans-serif;
}
.postshow {
    padding: 20px;
    text-align: justify;
    margin: 25px;
    border-radius: 20px;
    background: white;
    min-height: 100px;
    width: 90%;
    box-shadow: 0 0 5px gray;
}
.postshow h2{
    color: green;
}
.postshow hr{
    background: green;
}
.postshow p{
    font-size: 25px;
}


#footer {
    background: white;
    border: none;
    border-top: 3px solid green;
    position: fixed;
    z-index: 10000;
    width: 100%;
    min-height: 70px;
    bottom: 0;
    left: 0;
    padding: 20px;
}
#footerBtn {
    width: 90%;
}
#footerBtn td{
    text-align: center;
}
#footerBtn button {
    width: 110px;
    height: 80px;
    border: none;
    background: none;
    border-radius: 20px;
    font-size: 25px;

}
#footerBtn button:hover {
    background: rgba(0,100,255,0.1);

}
#specialBtn {
    width: 110px;
    height: 110px;
    border: 2px solid black;
    background: none;
    border-radius: 90px;
    font-size: 35px;
    padding: 5px;
}
#profdiv {
    background: white;
    padding: 20px;
    margin: 20px;
    border: none;
    border-radius: 20px;
}
#profdiv p{
    font-size: 50px;
    font-weight: bold;
    color: green;
}
#profdiv h3{
    color: red;
}
#profdiv hr{
    height: 15px;
    background: rgba(150,150,150,0.3);
}
#editbtn {
    position: absolute;
    z-index: 100;
    top: 330px;
    left: 260px;
}
#editbtn button{
    border: none;
    height: 60px;
    width: 60px;
    border-radius: 90px;
    box-shadow: 0 0 3px gray;
    font-size: 20px;
}
#profPic {
    background: rgba(255,255,0,0.1);
    height: 230px;    
    width: 230px;
    border: 10px solid rgba(0,0,0,0.2);
    border-radius: 360px;
    font-size: 150px;
    padding-top: 20px;
    padding-left: 20px;
}
#reactPanal {
    display: flex;
    padding: 10px;
    border: 1px solid green;
    border-radius: 20px;
    text-align: center;
    width: 70%;
    margin-left: 15%;
}
#reactPanal button {
    border: none;
    width: 33%;
    font-size: 20px;
    border-left: 1px solid green;
    background: none;
    cursor: pointer;
}

.appearFlex {
    position: fixed;
    z-index: 90;
    bottom: 140px;
    left: 0;
    margin-bottom: 10px;
    display: none;
    overflow: auto;
    padding-left: 20px;
}
.appearFlex button {
    padding: 10px;
    font-size: 25px;
    border: 2px solid red;
    border-radius: 20px;
    min-width: 70px;
    margin: 10px;
    background: white;
    box-shadow: 0 0 6px red;
}
.appearFlex button:hover {
    transform: scale(1.25);
    transition: all 0.3s ease;
}
#modal {
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
}
#modal div {
    padding: 20px;
    padding-top: 10px;
    width: 50%;
    background: white;
    border-radius: 20px;
    border: 3px solid red;
    box-shadow: 0 0 5px white;
}
#modal p {
    color: red;
    font-size: 15px;
}
#modal input {
    width: 90%;
    margin-top: 15px;
    border: none;
    border-bottom: 3px solid rgba(0,0,0,0.2);
    padding: 10px;
    text-align: center;
    font-size: 20px;
    color: red;
}
#modal button {
    margin: 15px;
    padding: 10px;
    width: 20%;
    border: 2px solid red;
    border-radius: 10px;
    background: lightyellow;
    color: red;
    font-size: 14px;
}
.crossBtn {
    background: none;
    border: none;
}
#alert {
    color: red;
    font-size: 15px;
    margin: 10px;
}

.Display {
    height: 70%;
    width: 90%;
    box-shadow: 0 0 10px gray;
    border-radius: 20px;
    background: white;
    padding: 20px;
    overflow: auto;
}
.Display hr {
    background: green;
}
.Display h1 {
    color: green;
}
.Display div p{
    background: rgba(240,240,240);
    border-radius: 10px;
    box-shadow: 0 0 5px gray;
    margin: 20px;
    padding: 20px;
    width: 50%;
    text-align: justify;
    font-size: 20px;
}

.Display section {
    background: rgba(0,0,0,0.1);
    padding: 2px;
    border: 5px solid rgba(0,0,0,0.2);
    border-radius: 90px;
    font-size: 20px;
    margin-top: 20px;
}

.comSecDiv {
    height: 70%;
    width: 90%;
    background: white;
    border: none;
    border-radius: 15px;
}
.comWord {
    height: 200px;          
    width: 80%;                 
    padding: 20px;             
    margin: 40px ;  
    text-align: justify;      
    border: 2px solid green;     
    border-radius: 20px;         
    color: green;             
    font-size: 18px;          
    resize: vertical;      
    outline: none;            
    box-shadow: 0 0 5px rgba(0,128,0,0.3);
    font-family: Arial, sans-serif;
    transition: all 0.3s ease;  
}

.comWord:focus {
    border-color: darkgreen;    
    box-shadow: 0 0 10px rgba(0,128,0,0.5);
}

.combutton {
    border: 2px solid black;
    border-radius: 10px;
    font-size: 20px;
    background: rgba(0,0,0,0.1);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px); 
    position: fixed;
    z-index: 1000;
    bottom: 880px;    
    right: 110px;     
    cursor: pointer;
    transition: all 0.3s ease;
    width: 50px;
    height: 50px;
    padding-top: 5px;
}


.combutton:hover {
    background: green;
    color: white;
    transform: scale(1.15);
    box-shadow: 0 0 15px rgba(0,255,0,0.6);
}
.combutton:active {
    transform: scale(0.95);
}
.crossBtn {
    width: 30px;
    height: 30px;
    border: none;
    background: none;
    color: red;
    font-size: 30px;
    font-weight: bold;
    margin-left: 150px;
}

#countReactions button{
    font-size: 15px;
    background: none;
    border: none;
}
       .likeAppear {
           width: 100%;
           border: none;
           border-bottom: 1px solid black;
           border-top: 1px solid black;
       }
       .likeAppear div {
           font-size: 40px;
           border-right: 1px solid black;
           margin: 5px;
           width: 70px;
       }
       .likeAppear h2 {
           color: green;
           width: 150px;
       }
       .likeAppear p {
           color: blue;
           font-size: 20px;
           box-shadow: 0;
       }
       .likeAppear section {
           font-size: 40px;
           padding: 5px;
           border: 1px solid green;
           border-radius: 5px;
           box-shadow: 0 0 4px lightgreen;
           width: 60px;
           margin: 5px;
           background: none;
       }
       
/* Story container */
.story-container{
  display:flex;
  gap:12px;
  padding:15px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling:touch;
}

/* Hide scrollbar */
.story-container::-webkit-scrollbar{
  display:none;
}

/* Each story */
.story{
  min-width:200px;
  height:350px;
  background:#fff;
  border-radius:16px;
  display:flex;
  justify-content:center;
  align-items:center;
  box-shadow:0 8px 20px rgba(0,0,0,0.35);
  position:relative;
  overflow:hidden;
}

.story-inner{
  width:92%;
  height:92%;
  background:linear-gradient(160deg,#ff3d71,#ff9a9e);
  border-radius:14px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:10px;
  transition:transform 0.25s ease;
}

.story img{
  width:110px;
  height:auto;
  filter:drop-shadow(0 4px 6px rgba(0,0,0,0.3));
}

.story-title{
  color:white;
  font-size:20px;
  font-weight:600;
  letter-spacing:0.4px;
  opacity:0.95;
  background: rgba(255,130,130, 0.5);
  padding: 10px;
  border-radius: 90px;
  text-align: center;
}

#stryPort{
    background: rgba(0,0,0,0.3);
    width: 100%;
    height: 100%;
    display: none;
    justify-content:center;
    align-items:center;
    z-index: 100;
    position: fixed;
    top: 0;
    left: 0;
}
#stryPort div{
    width: 90%;
    height: 80%;
    background: white;
    border-radius: 20px;
}
.videoBtn{
    padding: 20px;
    border-radius: 90px;
    font-size: 30px;
    margin: 30px;
    border: none;
    background: #305ac1;
    color: white;
}
#showingStory{
    display: flex;
}
#showingStory div {
    width: 200px;
    height: 320px;
    padding: 10px;
    box-shadow: 10 10 10px black;
}
#showingStory video {
    height: 320px;
    border-radius: 20px;
}

    </style>
</head>
<body id="body">
<div id="header">
<img src="https://i.ibb.co.com/wNpFN8qH/IMG-20251103-150220.jpg"  width="200px">
  <h1 id="profPicture"></h1>
</div>
      

<div id="bio"></div>

<div id="searchpad">
<div style="background: none; width: 100%;">
    <div style="text-align: right; padding-right: 70px;">
        <button onclick="closealert('show');closealert('searchpad');" id="close">√ó</button>
    </div>
    <input type="text" id="search" placeholder="Search here for any ID.."/>
    <button onclick="pad();" id="btnsearch"><img src="https://i.ibb.co.com/hxhm3n7y/search-interface-symbol.png" alt="search interface symbol" border="0" width="25"></button>  
   
          <div id="show">
              <div>
              <div id="showheader">
              <h2>
                 Search Result
              </h2>
              </div>
              <div id="searchresult"></div>
          </div>
          </div>

 </div>
    </div>
 
 <div id="postpage">
 <div id="postpad">
      <table border="0" id="nameplate"><tr><td><h2 style="text-align: left; color: green;">Create your mind here..</h2>
 </td><td>
      <div style="text-align: right">
          <button onclick="closealert('postpage')">√ó</button>
      </div> 
      </td> 
      </tr>
      </table>
                <div style="text-align: right;">
               <button onclick="postsubmit()" id="postsubmit">Post </button>
         </div>

      <div>         
      <textarea id="postword" placeholder="What's on your mind?"></textarea>

      </div>
 </div>
 </div> 
<div id="allChange">
 
 <h2 style="padding-left:15px;">Stories</h2><hr>

<div class="story-container">
<div class="story">
  <div class="story-inner">

    <h1 style="position: absolute; z-index: 50; top: 0px; right: 0px; background: #ff3d71;border: 5px solid #ff3d71; border-radius: 90px;" id="storyProf">
    </h1>

    <!-- hidden gallery input -->


    <button
      style="background: pink; border: none; border-radius: 90px; padding: 10px; box-shadow: 0 0 10px white;"
      onclick="openStoryPort(); appClsBtn()"
    >
          <img 
        id="storyImg"
        src="https://i.ibb.co.com/CsX8QXq1/love-books.png"
        alt="Love Books"
        width="120"
      >

    </button>

    <div class="story-title">Art your mind</div>

  </div>
</div>
  <div id="showingStory"></div>
</div>

<hr>
<div id="content"></div>
</div>
<div id="stryPort">
    <div>       
        
 <div style="background: white; height: 97%; width: 94%; margin: 20px; display: flex; justify-content:center; align-items:center;" class="showHere">

<div style="text-align: right;" id="clsBtnDo">
    <button onclick="closealert('stryPort')" style="display: flex; justify-content:center; align-items:center; padding: 20px; font-size: 30px; color: white; border: none; border-radius: 90px; width: 50px;height: 50px; background: red;">
        √ó
    </button>
</div>
   
<input 
    type="file" 
    id="storyFile" 
    accept="image/*,video/*" 
    style="display:none"
    onchange="loadFromGallery(event)"
  >
     <section style="position: fixed; z-index: 10000; top:100px; display: none;" id="storyChange">
 <table align="center">
     <tr>
<td><button onclick="closeStryPort()" class="videoBtn">Close</button></td>             
<td><button onclick="openGallery()" class="videoBtn">Change</button></td>
<td><button onclick="sendStory()" class="videoBtn">Create</button></td>
     </tr>
 </table>
    </section>


  <button onclick="openGallery()" 
  id="plusBtn"
  style="
      font-size: 30px;
      width: 400px;
      height: 200px;
      background: linear-gradient(30deg,cyan,lightgreen);
      border: none;
      border-radius: 20px;
      display: block;
      color:red;
      box-shadow: 0 0 30px green;
      cursor:pointer;
      position:absolute;
      z-index:50;
    ">
    + Create Your Story
  </button>

  <video id="storyVideo" controls style="
      max-width:100%;
      max-height:90%;
      border-radius:20px;
      display:none;
  "></video>

  <img id="storyImg" src="" style="
      max-width:90%;
      max-height:90%;
      border-radius:20px;
      display:none;
  ">
        
    </div>
    </div>
</div>



<div id="appearFlex">
</div>
<footer id="footer">
    <div>
        <table id="footerBtn">
            <tr>
<td><button onclick="location.reload()"><img src="https://i.ibb.co.com/wZFh56jy/home.png" alt="home" border="0" width="40"></button></td>
<td><button onclick="profile();loadProfile();"><img src="https://i.ibb.co.com/YgKxNZB/user.png" alt="user" border="0" width="40"></button></td>
<td><button onclick="createpost()" style="    
    width: 90px;
    height: 90px;
    border: 2px solid black;
    background: none;
    border-radius: 90px;
    font-size: 40px;
    padding: 5px;
    color: black;
">+</button></td>
<td><button onclick="setting();"><img src="https://i.ibb.co.com/F4RcTPbR/setting.png" alt="setting" border="0" width="40"></button></td>
<td><button onclick="searchpad();"><img src="https://i.ibb.co.com/hxhm3n7y/search-interface-symbol.png" alt="search interface symbol" border="0" width="40"></button></td>
            </tr>
        </table>
    </div>
</footer>




<div id="otherProf"  style="
    background: rgba(0,0,0,0.2);
    width: 100%;
    height: 100%;
    z-index: 100;
    top:0;
    left:0;
    position: fixed;
    display: none;
    justify-content: center;
    align-items: center;

 ">
    <section style="
    background: white;
    height: 77%;
    width: 90%;
    border-radius: 20px;
    padding: 20px;
    position:relative;
    overflow: auto;
">
        <table style="width: 700px; position: fixed; z-index: 1000; background: rgba(255,255,255,0.8);"><tr><td>
  <h2 style="color: green;width: 600px;" id="headerName"></h2>  
  </td>
 <td><button onclick="closealert('otherProf')" style="background: none; border: none; font-size: 40px; color: red;">
     √ó
 </button></td> 
  </tr><tr><td colspan="2"><hr style="background: green;"></td></tr></table> 
 <div id="otherProfdiv" style="   
    background: white;
    padding: 20px;
    margin: 20px;
    margin-top: 100px;
    border: none;
    border-radius: 20px;
">

     <table align="center"><tr>
     <td width="270">
     <div id="otherProfPic" style="
    background: rgba(255,255,0,0.1);
    height: 230px;    
    width: 230px;
    border: 10px solid rgba(0,0,0,0.2);
    border-radius: 360px;
    font-size: 150px;
    padding-top: 20px;
    padding-left: 20px;
"></div></td>
     <td width="400">
     <p id="idName" style="   
    font-size: 50px;
    font-weight: bold;
    color: green;
"></p>
     <h4 style="color: red;"><u><i id="otherProfileBio"></i></u></h4>
  </td></tr></table>
 <br><br><br><hr style="background: rgba(0,0,0,0.1); height: 10px;"></div>
 
 <div id="otherPosts" style="position:relative; overflow: auto; padding: 10px"></div>   
    </section>
</div>
    


<script>
let selectedVideoFile = null;
let selectedVideoSrc = "";

/* ---------- Helpers ---------- */
const $ = id => document.getElementById(id);
const qs = sel => document.querySelector(sel);

/* ---------- Open / Close ---------- */
function openGallery(){ $("storyFile").click(); }
function openStoryPort(){ $("stryPort").style.display = "flex"; }
function closeStryPort(){
  if(!confirm("Are you sure you want to close the story?")) return;

  const video = $("storyVideo");
  if(video){ video.pause(); video.currentTime=0; }
  $("stryPort").style.display = "none";
}

/* ---------- Load video from gallery ---------- */
function loadFromGallery(e){
  const file = e.target.files[0];
  if(!file) return;

  if(!file.type.startsWith("video")){
    alert("Only video is supported");
    return;
  }

  selectedVideoFile = file;
  selectedVideoSrc = URL.createObjectURL(file);

  $("clsBtnDo").style.display = "none";
  const video = $("storyVideo");
  video.src = selectedVideoSrc;
  video.style.display = "block";

  $("plusBtn").style.display = "none";
  $("storyChange").style.display = "block";
  qs(".showHere").style.background = "black";

  setTimeout(()=>video.play().catch(()=>{}),150);
}

/* ---------- Reset / Close story prep ---------- */
function appClsBtn(){
qs(".showHere").style.background = "transparent";  qs(".showHere").innerHTML = `
<div style="text-align: right;" id="clsBtnDo">
  <button onclick="closealert('stryPort')" style="display:flex;justify-content:center;align-items:center;padding:20px;font-size:30px;color:white;border:none;border-radius:90px;width:50px;height:50px;background:red;">√ó</button>
</div>
<input type="file" id="storyFile" accept="image/*,video/*" style="display:none" onchange="loadFromGallery(event)">
<section style="position:fixed;top:100px;z-index:10000;display:none;" id="storyChange">
  <table align="center">
    <tr>
      <td><button onclick="closeStryPort()" class="videoBtn">Close</button></td>
      <td><button onclick="openGallery()" class="videoBtn">Change</button></td>
      <td><button onclick="prepearStory()" class="videoBtn">Create</button></td>
    </tr>
  </table>
</section>
<button onclick="openGallery()" id="plusBtn" style="font-size:30px;width:400px;height:200px;background:linear-gradient(30deg,cyan,lightgreen);border:none;border-radius:20px;color:red;box-shadow:0 0 30px green;cursor:pointer;position:absolute;z-index:50;">
  Create Your Story
</button>
<video id="storyVideo" controls style="max-width:100%;max-height:90%;border-radius:20px;display:none"></video>
<img id="storyImg" src="" style="max-width:90%;max-height:90%;border-radius:20px;display:none">
  `;
}

/* ---------- Prepare story screen ---------- */
function prepearStory(){
  if(!selectedVideoFile) return alert("Please select a video first!");

  const box = qs(".showHere");
  box.style.background = "transparent";

  box.innerHTML = `
<div style="height:100%;width:100%;">
  <div style="text-align:right">
    <button onclick="appClsBtn()" style="background:none;border:none;color:red;font-size:40px;">√ó</button>
  </div>
  <div style="position:fixed;top:250px;width:600px;">
    <video id="prepearVideo" muted style="max-width:100%;max-height:300px;border-radius:20px;"></video>
    <hr>
    <textarea id="storyCaption" placeholder="Write something about this video..."
      style="height:300px;width:500px;border:none;padding:20px;font-size:30px;border-radius:20px; font-family: 'SolaimanLipi', 'Noto Sans Bengali', Arial, sans-serif;
"></textarea>
    <hr>
    <div style="text-align:right">
      <button onclick="sendStory()" style="background:red;padding:20px;border:none;border-radius:10px;color:white;">
        Post
      </button>
    </div>
  </div>
</div>`;

  const pv = $("prepearVideo");
  pv.src = selectedVideoSrc;
  pv.currentTime = 0;
  pv.play();
  setTimeout(()=>pv.pause(),1000);
}

/* ---------- Send story to backend ---------- */
function sendStory(){
  if(!selectedVideoFile) return alert("No video selected");

  const user = JSON.parse(localStorage.getItem("user") || "{}");

  const fd = new FormData();
  fd.append("storyVideo", selectedVideoFile);
  fd.append("caption", $("storyCaption")?.value || "");
  fd.append("username", user.username || "");
  fd.append("email", user.email || "");
  fd.append("avatar", user.avatar || "");

  fetch("https://story-server-9d2k.onrender.com/upload-story",{
    method:"POST",
    body:fd
  })
  .then(r=>r.json())
  .then(()=>{ alert("Story uploaded ‚úÖ"); closeStryPort(); })
  .catch(console.error);
}


/* ---------- Fetch and show all stories ---------- */
async function loadAllStories() {
  const container = document.getElementById("showingStory");
  container.innerHTML = "Loading stories...";

  try {
    const res = await fetch("https://story-server-9d2k.onrender.com/stories");
    const stories = await res.json();

    if (!stories.length) {
      container.innerHTML = "<p>No stories yet.</p>";
      return;
    }

    container.innerHTML = "";

    stories.forEach(story => {

      /* ---------- Story Card ---------- */
      const btn = document.createElement("button");
      btn.style = `
        width:220px;
        height:330px;
        margin:10px;
        border-radius:12px;
        overflow:hidden;
        border:none;
        cursor:pointer;
        position:relative;
        background:black;
        box-shadow: 10px 10px 20px rgba(128,128,128,0.6);
      `;

      /* ---------- Video thumbnail ---------- */
      const video = document.createElement("video");
      video.src = story.videoURL;
      video.muted = true;
      video.preload = "metadata";
      video.playsInline = true;
      video.style = `
        width:100%;
        height:100%;
        object-fit:cover;
        pointer-events:none;
      `;
      video.onloadeddata = () => video.pause();

      /* ---------- Avatar ---------- */
      const avatar = document.createElement("p");
      avatar.innerText = story.avatar;
      avatar.style = `
        position:absolute;
        top:0px;
        right:8px;
        width:34px;
        height:34px;
        font-size:30px;
        border-radius:50%;
        border: none;
        background: none;
        z-index: 100;
      `;

      /* ---------- Username ---------- */
      const username = document.createElement("div");
      username.innerText = story.username || "Anonymous";
      username.style = `
        position:absolute;
        bottom:0;
        left:0;
        width:50%;
        padding:10px;
        font-size:20px;
        font-weight : bold;
        color:white;
        text-align:left;
        background:linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      `;

      /* ---------- Assemble ---------- */
      btn.appendChild(video);
      btn.appendChild(avatar);
      btn.appendChild(username);

      /* ---------- Click action ---------- */
      btn.onclick = () => showStoryModal(story);

      container.appendChild(btn);
    });

  } catch (err) {
    console.error(err);
    container.innerHTML = '<p style="color:red;">Network error</p>';
  }
}


/* ---------- Custom modal ---------- */
function showStoryModal(story) {

  // remove old modal if exists
  const old = document.getElementById("storyModalOverlay");
  if (old) old.remove();

  /* ---------- Overlay ---------- */
  const overlay = document.createElement("div");
  overlay.id = "storyModalOverlay";
  overlay.style = `
    position:fixed;
    inset:0;
    background:black;
    z-index:10000;
    display:flex;
    justify-content:center;
    align-items:center;
  `;

  /* ---------- Story Box ---------- */
  const box = document.createElement("div");
  box.style = `
    position:relative;
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
  `;

  /* ---------- Header (avatar + name) ---------- */
  const header = document.createElement("div");
  header.style = `
    position:absolute;
    top:15px;
    left:15px;
    display:flex;
    align-items:center;
    gap:10px;
    z-index:2;
  `;

  const avatar = document.createElement("p");
  avatar.innerText = story.avatar;
  avatar.style = `
    width:42px;
    height:42px;
    border-radius:50%;
    border:2px solid white;
    font-size: 30px;
  `;

  const username = document.createElement("span");
  username.innerText = story.username || "Anonymous";
  username.style = `
    color:white;
    font-size:30px;
    font-weight:600;
  `;

  header.appendChild(avatar);
  header.appendChild(username);

  /* ---------- Close button ---------- */
  const closeBtn = document.createElement("button");
  closeBtn.innerHTML = "√ó";
  closeBtn.style = `
    position:absolute;
    top:10px;
    right:15px;
    font-size:42px;
    color:white;
    background:none;
    border:none;
    cursor:pointer;
    z-index:2;
  `;
  closeBtn.onclick = () => overlay.remove();

  /* ---------- Video ---------- */
  const video = document.createElement("video");
  video.src = story.videoURL;
  video.controls = true;
  video.autoplay = true;
  video.playsInline = true;
  video.style = `
    height: 1300px;
    margin:auto;
    border-radius: 20px;
  `;

  /* ---------- Caption ---------- */
  const caption = document.createElement("div");
  caption.innerText = story.caption || "";
  caption.style = `
    position:absolute;
    bottom:0;
    left:0;
    width:100%;
    padding:20px;
    color:white;
    font-size:30px;
    text-align:left;
    background:linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    z-index:2;
  `;

  /* ---------- Assemble ---------- */
  box.appendChild(header);
  box.appendChild(closeBtn);
  box.appendChild(video);
  box.appendChild(caption);

  overlay.appendChild(box);
  document.body.appendChild(overlay);
}


/* ---------- Call on page load ---------- */
window.addEventListener("load", loadAllStories);




function closealert(id) {
    document.getElementById(id).style.display = 'none';
}


async function showOtherProf(email) {
    const overlay = document.getElementById("otherProf");
    const nameEl = document.getElementById("idName");
    const headerName = document.getElementById("headerName");
    const bioEl = document.getElementById("otherProfileBio");
    const picEl = document.getElementById("otherProfPic");
    const postsDiv = document.getElementById("otherPosts");

    overlay.style.display = "flex";
    postsDiv.innerHTML = "<p>Loading posts...</p>";

    try {
        /* üîπ Fetch profile */
        const userRes = await fetch(
          `https://users-server-xyvg.onrender.com/public-profile?email=${encodeURIComponent(email)}`
        );
        if (!userRes.ok) throw new Error("Profile not found");
        const user = await userRes.json();

        nameEl.innerText = user.username || "Unknown";
        bioEl.innerText = user.bio || "No bio";
        picEl.innerText = user.avatar || "N";
        headerName.innerText = `Profile of "${user.username}"`;

        /* üîπ Fetch posts */
        const postRes = await fetch(
          `https://posts-server-kmha.onrender.com/posts?email=${encodeURIComponent(email)}`
        );
        if (!postRes.ok) throw new Error("Posts not found");
        const posts = await postRes.json();

        postsDiv.innerHTML = "";

        if (posts.length === 0) {
            postsDiv.innerHTML = "<p style='text-align:center;'>No posts yet</p>";
            return;
        }

posts.forEach(post => {
    const div = document.createElement("div");
    div.style.cssText = `
        position: relative;
        background: white;
        margin: 15px;
        padding: 15px;
        border-radius: 15px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: 100%;
        overflow-wrap: break-word;
        word-wrap: break-word;
        box-sizing: border-box;
    `;

    div.innerHTML = `
        <h2 style="word-break: break-word;">
            <span style="padding: 10px; border-right: 1px solid gray; margin-right: 10px;">
                ${post.avatar}
            </span>
            <span style="color: green;">${post.username}</span>
        </h2>
        <hr style="background: green; height: 1px;">
        <p style="font-size:25px; word-break: break-word;">
            ${post.text.replace(/\n/g, "<br>")}
        </p>
    `;

    postsDiv.appendChild(div);
});


    } catch (err) {
        console.error(err);
        postsDiv.innerHTML = "<p style='color:red;'>Failed to load posts</p>";
    }
}


function closealert(id) {
    document.getElementById(id).style.display = "none";
}


function profile() {
const u = JSON.parse(localStorage.getItem("user"));
const s = JSON.parse(styleString);

    document.getElementById('allChange').innerHTML =`
 <div id="profdiv">
     <table align="center"><tr><td width="270">
     <div id="profPic"></div></td><td width="400">
     <p id="userName"></p>
     <h3><u><i id="profileBio" ></i></u></h3>
  </td></tr></table>
  <div id="editbtn"><a href="profileEdit.html">
  <button><img src="https://i.ibb.co.com/HfyLkxKy/edit.png" alt="edit" border="0" width="30"></button>
  </a></div> <br><br><br><hr></div>
 
 <div id="ownerPosts"></div>   
    
    `;

document.getElementById('profPic').innerHTML = `${u.avatar}`;       
document.getElementById('userName').innerHTML = `${u.username}`;       
document.getElementById('profileBio').innerHTML = `${u.bio}`;       

showLoader("ownerPosts", "Loading Owner's posts...");

warning(
    () => showWarning(".warn", "‚ö† Network seems slow!", () => {
        profile();
    }),
    5000,
    0,
    3000
);


loadProfilePosts();


}


function setting() {
location.href = 'setting.html';
  }
  
  

function searchpad() {
    document.getElementById('searchpad').style.display = 'flex';  
}

async function pad() {
    let search = document.getElementById('search').value;
    if(!search) {
        document.getElementById("show").style.display = 'none';  
        alert('Please search anything before');
    } else {
        document.getElementById('show').style.display = 'flex'; 
        
    
    const search = document.getElementById('search').value.trim().toLowerCase();
    const showDiv = document.getElementById("searchresult");

    // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá
    try {
        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶®‡¶õ‡ßá
        const res = await fetch("https://users-server-xyvg.onrender.com/users");
        const users = await res.json();

        // ‡¶∂‡ßÅ‡¶ß‡ßÅ ID ‡¶¨‡¶æ email ‡¶¶‡¶ø‡ßü‡ßá filter
        const results = users.filter(u => u.username.toLowerCase().includes(search));

        if (results.length === 0) {
            showDiv.style.display = 'flex';
            showDiv.innerHTML = `<p style=" color:red">No user found for "<b>${search}</b>"</p>`;
        } else {
            showDiv.style.display = 'flex';
            showDiv.innerHTML = results.map(u => `
  <button onclick="closealert('searchpad'); showOtherProf('${u.email}')" style="background: none; width: 70%; border: none;">                
                <div style="border:none; margin:5px; padding:10px; color: green; width: 100%; text-align: left;">
                    ${u.username} <br><hr style="background: green; height: 2px;">
                </div></button>
            `).join("");
      }  
    } catch (err) {
        alert("Check your network connection please!!");
    }
}
          
    }


function createpost() {
    document.getElementById('postpage').style.display = 'flex';   
} 

function clearpost() {
    document.getElementById('postword').value = "";    
} 

async function postsubmit() {
  const input = document.getElementById('postword');
  const text = input.value.trim();

  if (!text) {
    alert("Please write something!");
    return;
  }

  const user = JSON.parse(localStorage.getItem("user"));
  if (!user || !user.username) {
    alert("User not found!");
    return;
  }

  const btn = document.getElementById("postbtn");
  if (btn) btn.disabled = true;

  try {
    const res = await fetch("https://posts-server-kmha.onrender.com/post", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
body: JSON.stringify({
  user: {
    username: user.username,
    email: user.email
  },
  text: text,
  avatar: user.avatar 
})    

});

    // ‚ùå Server responded with error (4xx or 5xx)
    if (!res.ok) {
      let serverData = {};
      try {
        serverData = await res.json();
      } catch (e) {
        console.error("Error parsing server response:", e);
      }

      // Pretty print server error
      console.error(
        `Server Error Response (status: ${res.status} ${res.statusText}):\n`,
        JSON.stringify(serverData, null, 2)
      );

      alert("Server error. Please try again.");
      return;
    }

    // ‚úÖ Success
    alert('Posted successfully');
    location.reload();
  } catch (err) {
    // ‚ùå Network / JS error
    console.error("Network / JS Error:", err);
    alert("Something went wrong. Please try again.");
  } finally {
    if (btn) btn.disabled = false;
  }
}

async function loadPosts() {

    try {
        const res = await fetch("https://posts-server-kmha.onrender.com/post");
        const data = await res.json();

        if (res.ok) {
            const contentDiv = document.getElementById("content");
            contentDiv.innerHTML = "";

            data.forEach(post => {      
                const div = document.createElement("div");
                div.className = "postshow";
                div.innerHTML += `<table><tr><td>
        
           <span style="padding: 5px; border-right: 2px solid rgba(0,0,0,0.2); margin-right: 10px; font-size: 60px;">${post.avatar} </span></td> <td style="width: 650px">
  <h2>
      <button onclick="showOtherProf('${post.email}')" style="background: none; border:none; font-size: 25px; font-weight: bold; color: green;">
<div style="font-size: 50px; text-align: left;">${post.username}</div></button>
          <span style="text-align: right;"></span>
          </h2></td>
          <td>
     <button style="background: none; border: none;" class="copyBtn" data-text="${post.text.replace(/"/g, "&quot;")}">
         <img src="https://i.ibb.co.com/yBd6Bf4F/copy.png" alt="copy" border="0" width="30">
         </button>
</td></tr></table><hr>
                
    
<p style="font-size: 30px;">${post.text.replace(/\n/g, "<br>")}</p>
    
    <div id="countReactions">
   <div id="countByOrder${post.id}" style="text-align: right">
 <button id="likeCount${post.id}" onclick="likeContainer(${post.id}); reactors(${post.id})"></button> <br>     
 <button id="commentCount${post.id}" onclick="appContainer(${post.id}); comText(${post.id})"></button>      
   </div>
     </div>
    
    <div id="reactPanal">
<button onclick="appImoji(${post.id})" style="border-left: none; font-size: 30px;"
 id="react${post.id}">
 <img src="https://i.ibb.co.com/NgV9p5jg/like.png" alt="like" border="0" width="40"></button>
<button onclick="comSec(${post.id})" id="comSec${post.id}"><img src="https://i.ibb.co.com/hRNSdTgD/comment.png" alt="comment" border="0" width="40"></button>
<button>
  <img src="https://i.ibb.co.com/C5fxp0rs/share-1.png" alt="share (1)" border="0" width="30"></button>
</div>
    
    <div id="appearFlex${post.id}" class='appearFlex'>
<button onclick="reactAppear(${post.id},'üëç')">üëç</button>
<button onclick="reactAppear(${post.id},'‚ô•Ô∏è')">‚ô•Ô∏è</button>
<button onclick="reactAppear(${post.id},'ü§£')">ü§£</button>
<button onclick="reactAppear(${post.id},'üòÅ')">üòÅ</button>
<button onclick="reactAppear(${post.id},'ü§î')">ü§î</button>
<button onclick="reactAppear(${post.id},'ü•∞')">ü•∞</button>
<button onclick="reactAppear(${post.id},'üò•')">üò•</button>
<button onclick="reactAppear(${post.id},'üò°')">üò°</button>
</div>

<div id="comPen${post.id}" style="display:none; position: fixed; z-index: 100; height: 100%; width: 100%; background: rgba(0,0,0,0.3); top:0; left: 0; justify-content: center;align-items: center;">
    
    <div class="comSecDiv">
  <table>
      <tr>
          <td>
              <h2 style="margin-left: 20px;">
Write a comment here about this post..                 
              </h2>
          </td>
          <td>
<button onclick="closealert('comPen${post.id}')" class="crossBtn">
    √ó
</button>             
          </td>
      </tr>
  </table> 
  <hr> 
     <textarea class="comWord" placeholder="Enter here your comment..."></textarea>   
     <button onclick="sendCom(${post.id})" class="combutton">
         <img src="https://i.ibb.co.com/JZTLHkQ/send.png" alt="send" border="0" width="30">
     </button>      
   
    </div>
  
 </div>   


<div id="commentContainer${post.id}" style="   
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
">
    <div class="Display">
  <table style="width: 700px; position: fixed; z-index: 1000; background: rgba(255,255,255,0.8);"><tr><td>      
          <h1 id="reactName">Comments</h1></td><td>
    <div style="text-align: right;">
<button 
    style="
        color: red; 
        font-size: 30px; 
        border: none; 
        background: none; 
        cursor: pointer;" 
    onclick="closeContainer(${post.id})"
>
    √ó </button>  
     </div>
      </td></tr>
 <tr><td colspan="2"><hr></td></tr>     
      </table>
        
 <div id="comText${post.id}" style="position: relative; margin-top: 140px"></div>       
    </div>
</div>


<div id="likeContainer${post.id}" style="   
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
">
    <div class="Display">
  <table style="width: 700px; position: fixed; z-index: 1000; background: rgba(255,255,255,0.8);"><tr><td>      
          <h1 id="reactName">Reactions</h1></td><td>
    <div style="text-align: right;">
<button 
    style="
        color: red; 
        font-size: 30px; 
        border: none; 
        background: none; 
        cursor: pointer;" 
    onclick="closeLikeContainer(${post.id})"
>
    √ó </button>  
     </div>
      </td>
      <tr><td colspan="2"> <hr></td></tr>
      </tr></table>
     
 <div id="reactors${post.id}" style="position: relative; margin-top: 140px;"></div>       
    </div>
</div>

    `;
    
       // let displayText = postText.length > 5 ? postText.slice(0, 5) + "..." : postText;

document.addEventListener("click", e => {
  const btn = e.target.closest(".copyBtn");
  if (!btn) return;

  navigator.clipboard.writeText(btn.dataset.text);
});

                contentDiv.appendChild(div);
                updateCounts(post.id);
            });
        } else {
            alert(data.message || "Error loading posts!");
        }
    } catch (err) {
 }
}


async function reactors(postId) {
  try {
    const res = await fetch(
      `https://interacts-server-xpbo.onrender.com/likes/${postId}`
    );
    const data = await res.json();

    const container = document.getElementById(`reactors${postId}`);
    container.innerHTML = ""; // clear previous

    if (!data.likes || data.likes.length === 0) {
      container.innerHTML = `<p>No likes yet üòê</p>`;
      return;
    }

    // üîπ Map likes to HTML
    const listHTML = data.likes
      .map(l => {
        return `
          <table class="likeAppear">
            <tr>
              <td>
                <div>${l.avatar}</div>
              </td>
              <td>
                <h2>${l.username}</h2>
              </td>
              <td><p style="box-shadow:0 0 0px white; padding: 0; margin:0; background: none; width: 150px;">
                reacted with
              </p></td>
              <td style="font-size:20px"><section>
                ${l.reaction}</section>
              </td>
            </tr>
          </table>
        `;
      })
      .join("");

    container.innerHTML = listHTML;

  } catch (err) {
    console.error("Reactors fetch error:", err);
  }
}

function comSec(appear) {
   document.getElementById(`comPen${appear}`).style.display  = 'flex';
}

async function comText(postId) {
    const box = document.getElementById(`comText${postId}`);
    box.innerHTML = "Loading comments...";

    try {
        const res = await fetch(`https://interacts-server-xpbo.onrender.com/comments/${postId}`);
        const comments = await res.json();

        if (!comments || comments.length === 0) {
            box.innerHTML = "<p style='color: red;'>No comments yet</p>";
            return;
        }

        const currentUser = JSON.parse(localStorage.getItem("user")); // Logged in user
        const currentEmail = currentUser ? currentUser.email : null;

        box.innerHTML = "";

        comments.forEach(c => {
            const div = document.createElement("div");
    
    let comId = `${c.id}`;        
 
          
            const menuHTML = (currentEmail && currentEmail === c.email) ? `
                <div class="comMenu" style="display:none; position: absolute; right: 110px; top: 50px; border:1px solid gray; background:white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <button
 style="background: none; border: none; border-bottom: 1px solid gray; width: 100%;"           
             onclick="editCom(${comId}, '${postId}', '${c.comment.replace(/'/g, "\\'").replace(/\n/g, "\\n")}')">Edit</button>
            <br>
                  <button style="color: red; background: none; border: none; width: 100%; margin-top: 10px;" onclick="deleteCom(${c.id}, ${postId})">Delete</button>
                </div>
            ` : "";

            div.innerHTML = `
            <div style="position: relative; margin-bottom: 30px;">
              <table>
                <tr>
                  <td valign="top"><h2>${c.avatar}</h2></td>
                  <td>
                    <div style="
                        background: rgba(0,0,0,0.1);   
                        padding: 10px; 
                        border-radius: 10px;
                        width: 500px;
                        margin-left: 30px;
                        border-left: 5px solid gray;">
                      <table>
                        <tr>
                          <td><h3 style="color: green; margin: 0; width: 470px;">${c.username}</h3></td>
                          <td>
                            ${menuHTML ? `<button class="dropdownBtn" style="width: 20px; background: none; border: none; height: 40px; color: green; font-size: 20px; margin-left: 0px">‚ãÆ</button>` : ""}
                          </td>
                        </tr>
                      </table>
                      <hr style="background: green;">
                      
   <div id="commentText${c.id}">                   
                      <p style="text-align: justify; font-size: 18px; margin:0; box-shadow: none; background: 0; padding: 0; width: 100%;">${c.comment.replace(/\n/g, "<br>")}</p>
                      ${menuHTML}
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            `;

            box.appendChild(div);

            // Dropdown toggle only if menu exists
            if (menuHTML) {
                const dropdownBtn = div.querySelector(".dropdownBtn");
                const menu = div.querySelector(".comMenu");

                dropdownBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const isOpen = menu.style.display === "block";
                    document.querySelectorAll(".comMenu").forEach(m => m.style.display = "none"); // close all
                    menu.style.display = isOpen ? "none" : "block";
                });
            }
        });

        // Close dropdown if click outside
        document.addEventListener("click", () => {
            document.querySelectorAll(".comMenu").forEach(menu => menu.style.display = "none");
        });

    } catch (err) {
        console.error(err);
        box.innerHTML = "<p style='color:red'>Failed to load comments</p>";
    }
}


async function updateCounts(postId) {
    const likeEl = document.getElementById(`likeCount${postId}`);
    const commentEl = document.getElementById(`commentCount${postId}`);

    try {
        const res = await fetch(`https://interacts-server-xpbo.onrender.com/api/counts/${postId}`);
        if (!res.ok) throw new Error("Failed to fetch counts");

        const data = await res.json();
        if (likeEl) likeEl.textContent = `${data.likes} reactions`;
        if (commentEl) commentEl.textContent = `${data.comments} comments`;

    } catch (err) {
        console.error(`Error updating counts for post ${postId}:`, err);
        if (likeEl) likeEl.textContent = "‚Äì reactions";
        if (commentEl) commentEl.textContent = "‚Äì comments";
    }
}


async function sendCom(postId) {
    const overlay = document.getElementById(`comPen${postId}`);
    const textarea = overlay.querySelector(".comWord");
    const btn = overlay.querySelector(".combutton");
    const comment = textarea.value.trim();

    if (!comment) {
        alert("Please write a comment first!");
        return;
    }

    const user = JSON.parse(localStorage.getItem("user"));
    if (!user || !user.username || !user.email) {
        alert("User not found!");
        return;
    }

    btn.disabled = true;

    try {
        const res = await fetch("https://interacts-server-xpbo.onrender.com/comment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                postId: Number(postId),
                email: user.email,
                username: user.username,
                avatar: user.avatar ,
                comment
            })
        });

        if (!res.ok) {
            const errData = await res.json().catch(() => ({}));
            console.error("Server Error:", res.status, errData);
            alert(errData.message || "Failed to send comment!");
            return;
        }

        const data = await res.json();
        console.log("Saved comment:", data.comment);

        textarea.value = "";
        overlay.style.display = "none";
        alert("Comment posted ‚úÖ");

    } catch (err) {
        console.error("Network / JS Error:", err);
        alert("Network error!");
    } finally {
        btn.disabled = false;
    }
}

async function reactAppear(postId, emoji) {
  document.getElementById(`appearFlex${postId}`).style.display = "none";

  try {
    const user = JSON.parse(localStorage.getItem("user"));

    if (!user || !user.email || !user.username) {
      alert("You must be logged in to react!");
      return;
    }

    const res = await fetch(
      "https://interacts-server-xpbo.onrender.com/react",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          postId: postId,
          email: user.email,
          username: user.username,
          avatar: user.avatar,
          reaction: emoji
        })
      }
    );

    const data = await res.json();

    if (res.ok) {
      // UI update
      document.getElementById(`react${postId}`).innerHTML = emoji;
      return;
    } else {
      alert(data.message || "You have already reacted!");
    }

  } catch (err) {
    console.error("Error sending reaction:", err);
    alert("Something went wrong while sending your reaction.");
  }
}




function loadProfile() {
    const user = localStorage.getItem("user");
    if(user) {
        const u = JSON.parse(user);
document.getElementById("userName").innerHTML = u.username;
document.getElementById("profileBio").innerHTML = u.bio;

    }
    
}

function backtoprofile() {
    profile();
    document.querySelector('#backbtn').innerHTML = "";
}



// üîπ Load Current User Posts
async function loadProfilePosts() {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) return;

    const res = await fetch("https://posts-server-kmha.onrender.com/post");
    const allPosts = await res.json();

    // ‡¶∂‡ßÅ‡¶ß‡ßÅ current user-‡¶è‡¶∞ post filter
    const userPosts = allPosts.filter(p => p.email === user.email);

    const profileDiv = document.getElementById("ownerPosts");
    profileDiv.innerHTML = `<div id="userposts"></div>`;
    const postsDiv = document.getElementById("userposts");

    userPosts.forEach((p, i) => {
        const div = document.createElement("div");
        div.className = "postshow";
        div.innerHTML = `
            <div style="position: relative;">
                <table border="0" style="width: 100%;">
                    <tr>
                        <td><h3 style="color: green"><span style="padding: 5px; border-right: 2px solid rgba(0,0,0,0.2); margin-right: 10px; font-size: 50px;">${user.avatar} </span><span style="font-size: 50px; text-align: left;">${user.username}</span></h3></td>
                        <td style="text-align: right;">
                            <button 
                                id="dropdownBtn${p.id}" 
                                style="width: 20px; background: none; border: none; height: 40px; color: green; font-size: 50px;"
                            >‚ãÆ</button>
                        </td>
                    </tr>
                </table>
                <hr>
                <p id="posttext${p.id}" style="font-size: 30px;">${p.text.replace(/\n/g, "<br>")}</p>
                
                
                <div id="menu${p.id}" 
                    style="display:none; position: absolute; right: 0; top: 70px; border:1px solid gray; background:white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <button style="background: none; border: none; border-bottom: 1px solid gray; border-radius: 0; width: 100%;" onclick="editPost(${p.id}); closealert('menu${p.id}');">Edit</button><br>
                    <button style="color: red; background: none; border: none; border-radius: 0; margin-top: 10px; width: 100%;" onclick="deletePost(${p.id}); closealert('menu${p.id}');">Delete</button>
                </div>
            </div>
        `;
        postsDiv.appendChild(div);

        // üéØ Dropdown toggle system
        const dropdownBtn = div.querySelector(`#dropdownBtn${p.id}`);
        const menu = div.querySelector(`#menu${p.id}`);

        dropdownBtn.addEventListener("click", (e) => {
            e.stopPropagation(); // prevent document click from closing instantly
            const isOpen = menu.style.display === "block";
            document.querySelectorAll("[id^='menu']").forEach(m => m.style.display = "none"); // close all
            menu.style.display = isOpen ? "none" : "block"; // toggle current one
        });
    });

    // üß† Global click listener ‚Äî close dropdown if click outside
    document.addEventListener("click", (e) => {
        document.querySelectorAll("[id^='menu']").forEach(menu => {
            if (!menu.contains(e.target)) {
                menu.style.display = "none";
            }
        });
    });
}

// üîπ Edit Post
function editPost(id) {
    const el = document.getElementById(`posttext${id}`);
    if (!el) {
        console.error("Element not found for id:", id);
        return;
    }
    const textareaId = `editpost${id}`;
    const postText = el.innerText;

    el.outerHTML = `
        <table style="width: 100%;">
            <tr>
                <td>
                    <textarea id="${textareaId}" style="width: 80%; margin-top: 20px; border: 1px solid green; border-radius: 10px; height: 100px; padding: 20px; font-size: 16px; color: red;    font-family: 'SolaimanLipi', 'Noto Sans Bengali', Arial, sans-serif;
">${postText}</textarea>
                </td>
                <td>
                    <button onclick="savePost(${id})" style="background:white;width:100px;height:50px;border:1px solid green;border-radius:10px;color:green;margin-bottom:20px;">Save</button>
                    <br>
                    <button onclick="loadProfilePosts()" style="background:white;width:100px;height:50px;border:1px solid red;border-radius:10px;color:red;">Cancel</button>
                </td>
            </tr>
        </table>
    `;
}

// üîπ Save Post (PUT)
async function savePost(id) {
    const user = JSON.parse(localStorage.getItem("user"));
    const newText = document.getElementById(`editpost${id}`).value;

    try {
        const res = await fetch(`https://posts-server-kmha.onrender.com/post/${user.email}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: newText })
        });
        const data = await res.json();
        alert(data.message);
        loadProfilePosts();
    } catch(err) {
        console.error("Error saving post:", err);
        alert("Failed to save post.");
    }
}

// üîπ Delete Post
async function deletePost(id) {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!confirm("Are you sure to delete this post?")) return;

    try {
        const res = await fetch(`https://posts-server-kmha.onrender.com/post/${user.email}/${id}`, { method: "DELETE" });
        const data = await res.json();
        alert(data.message);
        loadProfilePosts();
    } catch(err) {
        console.error("Error deleting post:", err);
        alert("Failed to delete post.");
    }
}


// üîπ Edit comment
function editCom(comId, postId, encodedText) {
    let commentDiv = document.getElementById(`commentText${comId}`);

    if (!commentDiv) return;

    const currentText = decodeURIComponent(encodedText);

    commentDiv.innerHTML = `
        <textarea id="editArea${comId}" style="width:80%; height:80px; margin: 20px; border: 2px solid green; border-radius: 20px; box-shadow: 0 0 5px lightgreen; color: green; padding: 10px;    font-family: 'SolaimanLipi', 'Noto Sans Bengali', Arial, sans-serif;
">${currentText}</textarea>
        <br>
        <div style="text-align:right;">
        <button id="saveBtn${comId}" style="border: none; border-radius: 5px; background: rgb(0,200,0); color: rgb(255,255,255); padding: 4px;width: 100px;">Save</button>
        <button id="cancelBtn${comId}" style="border: none; border-radius: 5px; background: rgb(200,0,0); color: rgb(255,255,255); padding: 4px;width: 100px;">Cancel</button>
</div>
    `;

    document.getElementById(`saveBtn${comId}`).onclick = async () => {
    
    const user = JSON.parse(localStorage.getItem("user"));
        const newComment = document.getElementById(`editArea${comId}`).value.trim();
        if (!newComment) return alert("Comment cannot be empty!");

        try {
            const res = await fetch(`https://interacts-server-xpbo.onrender.com/comment/${user.email}/${comId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ newComment })
            });
            const data = await res.json();
            if (!res.ok) return alert(data.message || "Failed to update comment");

            alert("Comment updated ‚úÖ");
            comText(postId); // Refresh comments
        } catch (err) {
            console.error(err);
            alert("Network error: could not update comment.");
        }
    };

    document.getElementById(`cancelBtn${comId}`).onclick = () => {
        commentDiv.innerHTML = currentText;
    };
}


// üîπ Delete comment
async function deleteCom(commentId, postId) {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user || !user.email) {
        alert("User not found!");
        return;
    }

    if (!confirm("Are you sure you want to delete this comment?")) return;

    try {
        const res = await fetch(
            `https://interacts-server-xpbo.onrender.com/comment/${user.email}/${commentId}`,
            { method: "DELETE" }
        );

        const data = await res.json();

        if (!res.ok) {
            alert(data.message || "Failed to delete comment.");
            return;
        }

        alert("Comment deleted ‚úÖ");

        // Update the comments section for this post
        if (postId) {
            comText(postId); // reload comments for the post
        }
    } catch (err) {
        console.error("Error deleting comment:", err);
        alert("Network error: could not delete comment.");
    }
}






// üîπ Close dropdown
function closealert(menuId) {
    const el = document.getElementById(menuId);
    if(el) el.style.display = "none";
}


let closePlace = document.querySelector('#body');


function appImoji(id) {
document.getElementById(`appearFlex${id}`).style.display ='flex';
}



function closeImoji(id) {
    document.getElementById(`appearFlex${id}`).style.display ='none';
}

function closeContainer(container){
    document.getElementById(`commentContainer${container}`).style.display = 'none';
}

function appContainer(container) {
document.getElementById(`commentContainer${container}`).style.display ='flex';
}

function likeContainer(container) {
document.getElementById(`likeContainer${container}`).style.display ='flex';
}

function closeLikeContainer(container){
    document.getElementById(`likeContainer${container}`).style.display = 'none';
}



function appLink(postId) {
alert('üò• under contraction!');
}

function copyPost(postWord) {
 
  const cleanText = postWord
    .replace(/<br\s*\/?>/gi, "\n");

  navigator.clipboard.writeText(cleanText)
    .then(() => alert("Post copied ‚úÖ"))
    .catch(() => alert("Copy failed ‚ùå"));
}</script>


<script>
window.onload = function() {
    const user = localStorage.getItem("user");
    if(!user) {
        alert("Please login first!");
        location.href = "register.html";
    } else {
        const u = JSON.parse(user);
        document.getElementById('profPicture').innerHTML = `${u.avatar}`; 
        document.getElementById('storyProf').innerHTML = `${u.avatar}`; 
        loadPosts();
    }
}

// localStorage ‡¶•‡ßá‡¶ï‡ßá style ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶∏‡¶æ
const styleString = localStorage.getItem('style');
if (styleString) {
    const s = JSON.parse(styleString);
    document.getElementById('body').style.backgroundColor = s.background;
}

// ---------------------
// Loader Template Function
// ---------------------
function showLoader(targetId = "content", message = "Please wait...") {
    const loading = `
    <div style="width: 100%; text-align: center; margin-top: 20px;">
      <div class="loading-template">
        <div class="loading-image">
          <img src="https://i.ibb.co/67Tcn3S8/IMG-20251216-151652.png" >
        </div>
        <div class="warn">
          <div class="loading-text">${message}</div>
          <div class="loader">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>
      </div>
    </div>
    `;

    const target = document.getElementById(targetId);
    if (target) target.innerHTML = loading;
}

// ---------------------
// Warning Function
// ---------------------
function showWarning(targetSelector = ".warn", message = "‚ö† Check Your Network please!", retryFunc = null) {
    const warnEl = document.querySelector(targetSelector);
    if (!warnEl) return;

    warnEl.innerHTML = `
        <p style="color: red">${message}</p>
        <button class="retryBtn">‚ö° Retry</button>
    `;

    const btn = warnEl.querySelector(".retryBtn");
    if (btn) {
        btn.addEventListener("click", () => {
            if (typeof retryFunc === "function") {
                retryFunc(); // user-defined function call
            } else {
                console.log("No retry function provided, default reload");
                
            }
        });
    }
}


function warning(func, interval = 3000, duration = 0, delay = 3000) {
    if (typeof func !== "function") {
        console.error("‚ö† You must provide a function to run!");
        return;
    }

    const timeoutId = setTimeout(() => {
        const intervalId = setInterval(() => {
            func();
        }, interval);

        if (duration > 0) {
            setTimeout(() => {
                clearInterval(intervalId);
                console.log("‚èπ Warning stopped");
            }, duration);
        }
    }, delay);

    return timeoutId;
}

showLoader("content", "Loading posts...");

warning(
    () => showWarning(".warn", "‚ö† Network seems slow!", () => {
        location.reload();
    }),
    5000,
    0,
    3000
);

</script></body>
</html>
